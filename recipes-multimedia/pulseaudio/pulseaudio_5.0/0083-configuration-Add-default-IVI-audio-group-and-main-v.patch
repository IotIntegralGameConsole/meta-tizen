From: Tanu Kaskinen <tanu.kaskinen@linux.intel.com>
Date: Thu, 22 May 2014 14:43:33 +0300
Subject: configuration: Add default IVI audio group and main volume
 configuration

Change-Id: Idd348cc9f469e988405d574dbc2459c5822a33c2
Signed-off-by: Jaska Uimonen <jaska.uimonen@intel.com>
---
 src/Makefile.am                                | 21 ++++++++++++++++
 src/tizen-ivi-examples/audio-groups.conf       | 33 ++++++++++++++++++++++++++
 src/tizen-ivi-examples/main-volume-policy.conf | 20 ++++++++++++++++
 3 files changed, 74 insertions(+)
 create mode 100644 src/tizen-ivi-examples/audio-groups.conf
 create mode 100644 src/tizen-ivi-examples/main-volume-policy.conf

diff --git a/src/Makefile.am b/src/Makefile.am
index 8fa60ec..d57c30b 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -89,6 +89,8 @@ MODULE_LIBADD = $(AM_LIBADD) libpulsecore-@PA_MAJORMINOR@.la libpulsecommon-@PA_
 EXTRA_DIST = \
 		pulse/client.conf.in \
 		pulse/version.h.in \
+		tizen-ivi-examples/audio-groups.conf \
+		tizen-ivi-examples/main-volume-policy.conf \
 		daemon/daemon.conf.in \
 		daemon/default.pa.in \
 		daemon/system.pa.in \
@@ -111,6 +113,25 @@ pulseconf_DATA = \
 		daemon.conf \
 		client.conf
 
+# Add some Tizen specific configuration files.
+#
+# FIXME: These configuration files should be installed only if explicitly
+# requested, because they define policy which may not be the desired policy in
+# every Tizen profile. Currently default.pa loads module-audio-groups and
+# module-main-volume-policy only if module-murphy-ivi is installed in the
+# system, which helps with this issue, because non-IVI profiles don't
+# currently use module-murphy-ivi, so these configuration files won't have any
+# effect outside the IVI profile, but this is pretty hacky solution. It would
+# be better to load module-audio-groups and module-main-volume-policy
+# unconditionally, since they're not really tied to the Murphy module in any
+# way. We use this hack, because otherwise we'd need a configure switch for
+# enabling the example IVI configuration, and a new configure switch would also
+# require a new switch in the Tizen IVI image configuration. That's an extra
+# hurdle that we decided to avoid for now.
+pulseconf_DATA += \
+		tizen-ivi-examples/audio-groups.conf \
+		tizen-ivi-examples/main-volume-policy.conf
+
 if HAVE_DBUS
 dbuspolicy_DATA = \
 		daemon/pulseaudio-system.conf
diff --git a/src/tizen-ivi-examples/audio-groups.conf b/src/tizen-ivi-examples/audio-groups.conf
new file mode 100644
index 0000000..54939c9
--- /dev/null
+++ b/src/tizen-ivi-examples/audio-groups.conf
@@ -0,0 +1,33 @@
+[General]
+audio-groups = x-example-call-downlink-audio-group x-example-navigator-output-audio-group x-example-default-output-audio-group
+streams = call-downlink navigator-output default-output
+
+[AudioGroup x-example-call-downlink-audio-group]
+description = Call downlink
+volume-control = create
+mute-control = create
+
+[AudioGroup x-example-navigator-output-audio-group]
+description = Navigator
+volume-control = create
+mute-control = create
+
+[AudioGroup x-example-default-output-audio-group]
+description = Default
+volume-control = create
+mute-control = create
+
+[Stream call-downlink]
+match = (direction output AND property media.role=phone)
+audio-group-for-volume = x-example-call-downlink-audio-group
+audio-group-for-mute = x-example-call-downlink-audio-group
+
+[Stream navigator-output]
+match = (direction output AND property media.role=navigator)
+audio-group-for-volume = x-example-navigator-output-audio-group
+audio-group-for-mute = x-example-navigator-output-audio-group
+
+[Stream default-output]
+match = (direction output)
+audio-group-for-volume = x-example-default-output-audio-group
+audio-group-for-mute = x-example-default-output-audio-group
diff --git a/src/tizen-ivi-examples/main-volume-policy.conf b/src/tizen-ivi-examples/main-volume-policy.conf
new file mode 100644
index 0000000..5a73308
--- /dev/null
+++ b/src/tizen-ivi-examples/main-volume-policy.conf
@@ -0,0 +1,20 @@
+[General]
+output-volume-model = by-active-main-volume-context
+input-volume-model = none
+output-mute-model = by-active-main-volume-context
+input-mute-model = none
+main-volume-contexts = x-example-call-main-volume-context x-example-default-main-volume-context
+
+[MainVolumeContext x-example-call-main-volume-context]
+description = Call main volume context
+main-output-volume-control = bind:AudioGroup:x-example-call-downlink-audio-group
+main-input-volume-control = none
+main-output-mute-control = bind:AudioGroup:x-example-call-downlink-audio-group
+main-input-mute-control = none
+
+[MainVolumeContext x-example-default-main-volume-context]
+description = Default main volume context
+main-output-volume-control = bind:AudioGroup:x-example-default-output-audio-group
+main-input-volume-control = none
+main-output-mute-control = bind:AudioGroup:x-example-default-output-audio-group
+main-input-mute-control = none
