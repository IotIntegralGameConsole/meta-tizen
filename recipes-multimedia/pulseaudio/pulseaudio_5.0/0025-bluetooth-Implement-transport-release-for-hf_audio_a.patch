From: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Date: Fri, 23 Aug 2013 19:19:34 +0300
Subject: bluetooth: Implement transport release for hf_audio_agent transports

Change-Id: I496b3ab1c2f8e347c41262818ec3b9a35ed7262e
---
 src/modules/bluetooth/hfaudioagent-ofono.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/modules/bluetooth/hfaudioagent-ofono.c b/src/modules/bluetooth/hfaudioagent-ofono.c
index 90d1348..a0474df 100644
--- a/src/modules/bluetooth/hfaudioagent-ofono.c
+++ b/src/modules/bluetooth/hfaudioagent-ofono.c
@@ -153,6 +153,13 @@ static int hf_audio_agent_transport_acquire(pa_bluetooth_transport *t, bool opti
 }
 
 static void hf_audio_agent_transport_release(pa_bluetooth_transport *t) {
+    hf_audio_agent_data *hfdata = t->userdata;
+    hf_audio_card *hfac = pa_hashmap_get(hfdata->hf_audio_cards, t->path);
+
+    if (hfac) {
+        shutdown(hfac->fd, SHUT_RDWR);
+        hfac->fd = -1;
+    }
 }
 
 static void hf_audio_agent_card_found(hf_audio_agent_data *hfdata, const char *path, DBusMessageIter *props_i) {
