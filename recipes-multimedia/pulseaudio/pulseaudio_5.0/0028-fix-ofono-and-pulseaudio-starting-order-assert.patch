From: Jaska Uimonen <jaska.uimonen@intel.com>
Date: Thu, 2 Jan 2014 15:37:02 +0200
Subject: fix ofono and pulseaudio starting order assert

Change-Id: I743c6e1fb5c65cc0702f073d6c2beb4e6868d7bb
Signed-off-by: Jaska Uimonen <jaska.uimonen@intel.com>
---
 src/modules/bluetooth/hfaudioagent-ofono.c | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/src/modules/bluetooth/hfaudioagent-ofono.c b/src/modules/bluetooth/hfaudioagent-ofono.c
index 59eafdb..7f93c6b 100644
--- a/src/modules/bluetooth/hfaudioagent-ofono.c
+++ b/src/modules/bluetooth/hfaudioagent-ofono.c
@@ -403,10 +403,8 @@ static DBusHandlerResult filter_cb(DBusConnection *bus, DBusMessage *m, void *da
             if (old_owner && *old_owner) {
                 pa_log_debug("oFono disappeared");
 
-                if (hfdata->hf_audio_cards) {
-                    pa_hashmap_free(hfdata->hf_audio_cards);
-                    hfdata->hf_audio_cards = NULL;
-                }
+                if (hfdata->hf_audio_cards)
+                    pa_hashmap_remove_all(hfdata->hf_audio_cards);
 
                 if(hfdata->ofono_bus_id) {
                     pa_xfree(hfdata->ofono_bus_id);
