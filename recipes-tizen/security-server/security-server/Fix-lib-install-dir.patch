From 39acb736bd9dd5cfe6d25345e49e3e7b9b3e69f1 Mon Sep 17 00:00:00 2001
From: Xavier Roche <xavier.roche@open.eurogiciel.org>
Date: Thu, 19 Jun 2014 15:42:14 +0200
Subject: [PATCH] Fix lib Install dir

Signed-off-by: Xavier Roche <xavier.roche@open.eurogiciel.org>
---
 CMakeLists.txt                              | 3 ---
 build/security-server/CMakeLists.txt        | 2 +-
 build/security-server/security-server.pc.in | 2 +-
 src/CMakeLists.txt                          | 5 +++--
 src/server/CMakeLists.txt                   | 3 ++-
 5 files changed, 7 insertions(+), 8 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 476b94a..516c6bf 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -48,9 +48,6 @@ ADD_DEFINITIONS("-Werror")                      # Make all warnings into errors.
 ADD_DEFINITIONS("-Wall")                        # Generate all warnings
 ADD_DEFINITIONS("-Wextra")                      # Generate even more extra warnings
 
-STRING(REGEX MATCH "([^.]*)" API_VERSION "${VERSION}")
-ADD_DEFINITIONS("-DAPI_VERSION=\"$(API_VERSION)\"")
-
 ADD_DEFINITIONS("-DSMACK_ENABLED")
 
 IF (CMAKE_BUILD_TYPE MATCHES "DEBUG")
diff --git a/build/security-server/CMakeLists.txt b/build/security-server/CMakeLists.txt
index ddc0fb7..d65dd3a 100644
--- a/build/security-server/CMakeLists.txt
+++ b/build/security-server/CMakeLists.txt
@@ -22,5 +22,5 @@ CONFIGURE_FILE(security-server.pc.in security-server.pc @ONLY)
 INSTALL(FILES
     ${CMAKE_BINARY_DIR}/build/security-server/security-server.pc
     DESTINATION
-    ${LIB_INSTALL_DIR}/pkgconfig
+    lib/pkgconfig
     )
diff --git a/build/security-server/security-server.pc.in b/build/security-server/security-server.pc.in
index 608cb2d..df49caf 100644
--- a/build/security-server/security-server.pc.in
+++ b/build/security-server/security-server.pc.in
@@ -1,6 +1,6 @@
 prefix=@CMAKE_INSTALL_PREFIX@
 exec_prefix=${prefix}
-libdir=@LIB_INSTALL_DIR@
+libdir=${prefix}/lib
 includedir=${prefix}/include
 
 Name: security-server
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index b0270d4..634cf3c 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -51,7 +51,7 @@ ADD_EXECUTABLE(${TARGET_SECURITY_SERVER} ${SECURITY_SERVER_SOURCES})
 TARGET_LINK_LIBRARIES(${TARGET_SECURITY_SERVER}
     ${SECURITY_SERVER_DEP_LIBRARIES}
     ${TARGET_SERVER_COMMON}
-    -lcap
+    -lcap -lpthread
     )
 
 ################################################################################
@@ -89,11 +89,12 @@ SET_TARGET_PROPERTIES(
 TARGET_LINK_LIBRARIES(${TARGET_SECURITY_CLIENT}
     ${SECURITY_SERVER_DEP_LIBRARIES}
     ${TARGET_SERVER_COMMON}
+    -lpthread
     )
 
 ################################################################################
 
-INSTALL(TARGETS ${TARGET_SECURITY_CLIENT} DESTINATION ${LIB_INSTALL_DIR})
+INSTALL(TARGETS ${TARGET_SECURITY_CLIENT} DESTINATION lib)
 
 INSTALL(TARGETS ${TARGET_SECURITY_SERVER} DESTINATION bin)
 
diff --git a/src/server/CMakeLists.txt b/src/server/CMakeLists.txt
index 2cd6177..b86b473 100644
--- a/src/server/CMakeLists.txt
+++ b/src/server/CMakeLists.txt
@@ -45,9 +45,10 @@ SET_TARGET_PROPERTIES(
 
 TARGET_LINK_LIBRARIES(${TARGET_SERVER_COMMON}
     ${COMMON_DEP_LIBRARIES}
+    -lpthread
     )
 
 ################################################################################
 
-INSTALL(TARGETS ${TARGET_SERVER_COMMON} DESTINATION ${LIB_INSTALL_DIR})
+INSTALL(TARGETS ${TARGET_SERVER_COMMON} DESTINATION lib)
 
-- 
1.8.4.5

