From c4d409a068d570560ba92375d26702588324c3d3 Mon Sep 17 00:00:00 2001
From: Anas Nashif <anas.nashif@intel.com>
Date: Fri, 11 Jan 2013 21:45:07 -0800
Subject: [PATCH 04/20] Update to 1.1.6

---
 packaging/other       |  5 +++++
 packaging/pam.spec    | 15 +++++----------
 packaging/system-auth | 17 +++++++++++++++++
 3 files changed, 27 insertions(+), 10 deletions(-)
 create mode 100644 packaging/other
 create mode 100644 packaging/system-auth

diff --git a/packaging/other b/packaging/other
new file mode 100644
index 0000000..50c6e52
--- /dev/null
+++ b/packaging/other
@@ -0,0 +1,5 @@
+#%PAM-1.0
+auth       required   pam_deny.so
+account    required   pam_deny.so
+password   required   pam_deny.so
+session    required   pam_deny.so
diff --git a/packaging/pam.spec b/packaging/pam.spec
index 8cf314e..1ea9180 100644
--- a/packaging/pam.spec
+++ b/packaging/pam.spec
@@ -4,16 +4,15 @@
 %define _pamconfdir %{_sysconfdir}/pam.d
 
 Name:           pam
-Version:        1.1.5
+Version:        1.1.6
 Release:        1
 License:        BSD and GPLv2+ and BSD with advertising
 Summary:        PAM
 Url:            http://www.linux-pam.org/
 Group:          System/Base
-Source0:        %{name}-%{version}.tar.bz2
+Source0:        Linux-PAM-%{version}.tar.bz2
 Source1:        system-auth
 Source2:        other
-Source1001:     %{name}.manifest
 
 BuildRequires:  autoconf,
 BuildRequires:  automake,
@@ -58,13 +57,12 @@ contains header files and static libraries used for building both
 PAM-aware applications and modules for use with PAM.
 
 %prep
-%setup -q
+%setup -q -n Linux-PAM-%{version}
 
 libtoolize -f #--copy --force && aclocal && autoheader
 autoreconf
 
 %build
-cp %{SOURCE1001} .
 CFLAGS="-fPIC %{optflags} " ; export CFLAGS
 
 %configure \
@@ -109,8 +107,7 @@ fi
 
 
 %files
-%manifest pam.manifest
-%doc Copyright
+%license Copyright
 %{_sbindir}/pam_tally
 %{_sbindir}/pam_tally2
 %attr(4755,root,root) %{_sbindir}/pam_timestamp_check
@@ -183,11 +180,9 @@ fi
 %files devel
 %manifest pam.manifest
 %{_includedir}/security/*
-%doc %{_mandir}/man3/*
-%doc %{_mandir}/man5/*
-%doc %{_mandir}/man8/*
 %{_libdir}/libpam.so
 %{_libdir}/libpam_misc.so
 %{_libdir}/libpamc.so
 %{_libdir}/security/pam_tally2.so
 
+%docs_package
diff --git a/packaging/system-auth b/packaging/system-auth
new file mode 100644
index 0000000..44a1011
--- /dev/null
+++ b/packaging/system-auth
@@ -0,0 +1,17 @@
+#%PAM-1.0
+auth        required      pam_env.so
+auth        sufficient    pam_unix.so try_first_pass nullok
+auth        required      pam_deny.so
+
+account     required      pam_unix.so
+
+# cracklib is disabled in the build.
+# password    required      pam_cracklib.so try_first_pass retry=3 type=
+password    sufficient    pam_unix.so try_first_pass nullok sha512 shadow
+password    required      pam_deny.so
+
+session     optional      pam_keyinit.so revoke
+session     optional      pam_systemd.so
+session     required      pam_limits.so
+session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid
+session     required      pam_unix.so
-- 
1.8.1.4

